<div class="plateau-container">
  <button class="help-btn" *ngIf="!showRules" (click)="toggleRules()">?</button>

  <!-- Player setup form -->
  <div class="player-setup" *ngIf="!partieCree">
    <div class="player-setup">
      Bonjour ! veuillez rentrer les pseudos des joueurs. Ceux-ci doivent avoir √©t√© cr√©√© pr√©c√©demment dans la page inscription !
    </div>
    <div *ngFor="let joueur of joueursInit; let i = index" class="player-input"
         [ngClass]="i === 0 ? 'rouge' : i === 1 ? 'bleu' : i === 2 ? 'vert' : 'jaune'">
  <span class="assigned-color">
    Couleur :
    <span class="color-circle"></span>
    {{ i === 0 ? 'ROUGE' : i === 1 ? 'BLEU' : i === 2 ? 'VERT' : 'JAUNE' }}
  </span>
      <input [(ngModel)]="joueur.pseudo" placeholder="Pseudo joueur {{i+1}}" />
    </div>
    <button class="player-setup" (click)="startPartie()">Commencer Partie</button>
  </div>

  <!-- Game view -->
  <div *ngIf="partieCree" class="game-container">
    <div class="board-wrapper">
      <!-- Player sidebar -->
      <div class="players-sidebar">
        <h3>Joueurs</h3>
        <div *ngFor="let joueur of joueursPartie; let i = index"
             class="player-card"
             [ngClass]="i === 0 ? 'rouge' : i === 1 ? 'bleu' : i === 2 ? 'vert' : 'jaune'">
          <span class="player-color"
                [style.backgroundColor]="
                  i === 0 ? '#c0392b' :
                  i === 1 ? '#007bff' :
                  i === 2 ? '#28a745' :
                  '#fff799'
                "></span>
          <span class="player-pseudo">{{ joueur.joueur?.pseudo || 'Inconnu' }}</span>
        </div>
      </div>

      <!-- Plateau + dice -->
      <div class="board-and-dice">
        <!-- Dice -->
        <div class="dice-container">
          <div class="dice-wrapper">
            <div class="dice" [class.rolling]="isRolling">{{ diceValue || '-' }}</div>
            <div class="active-pion-indicator" [ngClass]="pionColor.toLowerCase()">{{ pionColor }}</div>
          </div>

          <button (click)="rollDiceTest()" [disabled]="isRolling">Lancer le d√©</button>
        </div>

        <!-- Plateau -->
        <div class="game-board">
          <div class="plateau">
            <div *ngFor="let c of casesAffichees; let i = index"
                 class="case"
                 [ngClass]="[c.couleur.toLowerCase(), c.typeCase ? c.typeCase.toLowerCase() : '', i === 112 ? 'centre' : '']"
                 [title]="c.couleur + ' ' + c.position">
              {{ c.typeCase ? c.position : '' }}

              <ng-container *ngFor="let img of getPionImgForCase(c)">
                <img [src]="img.src" [alt]="img.alt" class="pion" />
              </ng-container>
            </div>
          </div>

          <div class="restart-container">
            <button (click)="restartPions()">Restart Pions</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Rules panel -->
  <div class="rules-panel" [class.open]="showRules">
    <div class="rules-header">
      <h2>R√®gles du jeu</h2>
      <button class="close-btn" (click)="toggleRules()">‚úï</button>
    </div>
    <div class="rules-content"><regles></regles></div>
  </div>
</div>

<!-- Victory modal -->
<div class="victory-modal" *ngIf="showVictoryModal">
  <div class="victory-content">
    <h2>üèÜ Victoire !</h2>
    <ul>
      <li *ngFor="let c of classementFinal">{{c.position}} - {{c.pseudo}} ({{c.couleur}})</li>
    </ul>
    <button (click)="closeVictoryModal()">Fermer</button>
  </div>
</div>
